class Solution(object):
    def maxProfit(self, prices):
        """
        :type prices: List[int]
        :rtype: int
        
        """

        # https://stackoverflow.com/questions/2474015/getting-the-index-of-the-returned-max-or-min-item-using-max-min-on-a-list 
        # Get index of min and max values
        index_min = min(range(len(prices)), key=prices.__getitem__)  
        index_max = max(range(len(prices)), key=prices.__getitem__)

        if index_min == index_max:
            return 0
        
        if index_min < index_max:
            return prices[index_max] - prices [index_min]

        # Case 2: index max < index min, worse case
        """
        Idea: get local min from before max index --> maxprofit1
        Compare it to maxprofit2 --> 
        """
        def max_min(prices, index_min, index_max):
            local_min = min(range(index_max + 1), key=prices.__getitem__)
            # max_profit from before index max
            max_profit1 = prices[index_max] - prices[local_min]

            # Compare to max_profit after index max
            # Best case, the local min after index max is before local max after index max
            local_min2 = min(range(index_max +1, len(prices)), key=prices.__getitem__)
            local_max2 = max(range(index_max +1, len(prices)), key=prices.__getitem__)
            if local_min2 < local_max2:
                max_profit2 = prices[local_max2] - prices[local_min2]
                return max(max_profit1, max_profit2)
            
            # Worst case, same as case 2
            else:
                for i in range (index_max +1, len(prices)):
                    if i > 0 and prices[i] > prices[i-1]:  
                        continue
                    for j in range (i, len(prices)):
                        if prices[j] < prices[i]:  # No profit
                            continue
                        elif j>index_max + 1 and prices[j] < prices[j-1]:
                            continue
                        if prices[j] - prices[i] > max_profit1:
                            max_profit1 = prices[j] - prices[i]
            return max_profit1

        if index_max < index_min:
            return max_min(prices, index_min, index_max)
        
        return 0
